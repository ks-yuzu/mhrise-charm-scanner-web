var app=function(){"use strict";function t(){}function e(t){return t()}function l(){return Object.create(null)}function s(t){t.forEach(e)}function i(t){return"function"==typeof t}function m(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function p(e,l,s){e.$$.on_destroy.push(function(e,...l){if(null==e)return t;const s=e.subscribe(...l);return s.unsubscribe?()=>s.unsubscribe():s}(l,s))}function n(t,e){t.appendChild(e)}function g(t,e,l){t.insertBefore(e,l||null)}function a(t){t.parentNode.removeChild(t)}function o(t){return document.createElement(t)}function r(){return t=" ",document.createTextNode(t);var t}function c(t,e,l,s){return t.addEventListener(e,l,s),()=>t.removeEventListener(e,l,s)}function u(t,e,l){null==l?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}let j;function k(t){j=t}const f=[],h=[],d=[],v=[],_=Promise.resolve();let P=!1;function w(t){d.push(t)}let $=!1;const y=new Set;function T(){if(!$){$=!0;do{for(let t=0;t<f.length;t+=1){const e=f[t];k(e),L(e.$$)}for(k(null),f.length=0;h.length;)h.pop()();for(let t=0;t<d.length;t+=1){const e=d[t];y.has(e)||(y.add(e),e())}d.length=0}while(f.length);for(;v.length;)v.pop()();P=!1,$=!1,y.clear()}}function L(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const E=new Set;function b(t,e){-1===t.$$.dirty[0]&&(f.push(t),P||(P=!0,_.then(T)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function A(m,p,n,g,o,r,c=[-1]){const u=j;k(m);const f=m.$$={fragment:null,ctx:null,props:r,update:t,not_equal:o,bound:l(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:p.context||[]),callbacks:l(),dirty:c,skip_bound:!1};let h=!1;if(f.ctx=n?n(m,p.props||{},((t,e,...l)=>{const s=l.length?l[0]:e;return f.ctx&&o(f.ctx[t],f.ctx[t]=s)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](s),h&&b(m,t)),e})):[],f.update(),h=!0,s(f.before_update),f.fragment=!!g&&g(f.ctx),p.target){if(p.hydrate){const t=function(t){return Array.from(t.childNodes)}(p.target);f.fragment&&f.fragment.l(t),t.forEach(a)}else f.fragment&&f.fragment.c();p.intro&&((d=m.$$.fragment)&&d.i&&(E.delete(d),d.i(v))),function(t,l,m,p){const{fragment:n,on_mount:g,on_destroy:a,after_update:o}=t.$$;n&&n.m(l,m),p||w((()=>{const l=g.map(e).filter(i);a?a.push(...l):s(l),t.$$.on_mount=[]})),o.forEach(w)}(m,p.target,p.anchor,p.customElement),T()}var d,v;k(u)}function I(t){return new Promise((e=>{const l=new Image;l.src=t,l.onload=()=>{const t=cv.imread(l);e(t)}}))}function O(t,e,l,s,i){const m=new cv.Size(e.cols,e.rows),p=new cv.Rect(l,m),n=t.roi(p),g=new cv.Mat;cv.threshold(e,g,s,255,cv.THRESH_BINARY);const a=new cv.Mat;n.copyTo(a,g);const o=new cv.Mat;cv.absdiff(e,a,o),cv.cvtColor(o,o,cv.COLOR_BGR2GRAY);const r=new cv.Mat;return cv.threshold(o,r,i,255,cv.THRESH_BINARY),o.delete(),a.delete(),g.delete(),n.delete(),r}function x(t,e,l,s=63,i=63){let m=Number.MAX_SAFE_INTEGER,p=null;for(const[n,g]of Object.entries(e)){const e=O(t,g,l,s,i),a=cv.countNonZero(e);m>a&&(m=a,p=n),e.delete()}return p}function R(t){return t instanceof Promise?t:Array.isArray(t)?Promise.all(t.map(R)):"object"==typeof t?function(t){const e=Object.keys(t).map((e=>R(t[e]).then((t=>({key:e,value:t})))));return Promise.all(e).then((t=>t.reduce(((t,e)=>(t[e.key]=e.value,t)),{})))}(t):Promise.resolve(t)}class S{MAX_PAGE=34;POINT_RARITY=new cv.Point(1190,176);POINT_SLOTS=new cv.Point(1160,200);POINT_SKILL1=new cv.Point(1033,266);POINT_SKILL2=new cv.Point(1033,317);POINT_SKILL_LEVEL1=new cv.Point(1190,289);POINT_SKILL_LEVEL2=new cv.Point(1190,340);POINT_PAGE=new cv.Point(787,582);POINT_CHARM_AREA_LEFT_TOP=new cv.Point(635,359);SIZE_CHARM_AREA=new cv.Size(356,199);templates=null;async init(){this.templates={frame:I("img/templates/frame.png"),rare:{7:I("img/templates/rare/7.jpg"),6:I("img/templates/rare/6.jpg"),5:I("img/templates/rare/5.jpg"),4:I("img/templates/rare/4.jpg")},lvl:{0:I("img/templates/lvl/0.jpg"),1:I("img/templates/lvl/1.jpg"),2:I("img/templates/lvl/2.jpg"),3:I("img/templates/lvl/3.jpg"),4:I("img/templates/lvl/4.jpg"),5:I("img/templates/lvl/5.jpg")},slot:{0:I("img/templates/slot/0.jpg"),1:I("img/templates/slot/1.jpg"),11:I("img/templates/slot/11.jpg"),111:I("img/templates/slot/111.jpg"),2:I("img/templates/slot/2.jpg"),21:I("img/templates/slot/21.jpg"),211:I("img/templates/slot/211.jpg"),22:I("img/templates/slot/22.jpg"),221:I("img/templates/slot/221.jpg"),3:I("img/templates/slot/3.jpg"),31:I("img/templates/slot/31.jpg"),311:I("img/templates/slot/311.jpg"),32:I("img/templates/slot/32.jpg"),321:I("img/templates/slot/321.jpg")},skill:{"KO術":I("img/templates/skill/KO術.jpg"),"匠":I("img/templates/skill/匠.jpg"),"不屈":I("img/templates/skill/不屈.jpg"),"体術":I("img/templates/skill/体術.jpg"),"幸運":I("img/templates/skill/幸運.jpg"),"心眼":I("img/templates/skill/心眼.jpg"),"攻撃":I("img/templates/skill/攻撃.jpg"),"業物":I("img/templates/skill/業物.jpg"),"渾身":I("img/templates/skill/渾身.jpg"),"無し":I("img/templates/skill/無し.jpg"),"砲術":I("img/templates/skill/砲術.jpg"),"耐震":I("img/templates/skill/耐震.jpg"),"耳栓":I("img/templates/skill/耳栓.jpg"),"逆襲":I("img/templates/skill/逆襲.jpg"),"防御":I("img/templates/skill/防御.jpg"),"陽動":I("img/templates/skill/陽動.jpg"),"集中":I("img/templates/skill/集中.jpg"),"ボマー":I("img/templates/skill/ボマー.jpg"),"地質学":I("img/templates/skill/地質学.jpg"),"広域化":I("img/templates/skill/広域化.jpg"),"挑戦者":I("img/templates/skill/挑戦者.jpg"),"早食い":I("img/templates/skill/早食い.jpg"),"植生学":I("img/templates/skill/植生学.jpg"),"毒耐性":I("img/templates/skill/毒耐性.jpg"),"水耐性":I("img/templates/skill/水耐性.jpg"),"氷耐性":I("img/templates/skill/氷耐性.jpg"),"満足感":I("img/templates/skill/満足感.jpg"),"火耐性":I("img/templates/skill/火耐性.jpg"),"破壊王":I("img/templates/skill/破壊王.jpg"),"納刀術":I("img/templates/skill/納刀術.jpg"),"見切り":I("img/templates/skill/見切り.jpg"),"超会心":I("img/templates/skill/超会心.jpg"),"逆恨み":I("img/templates/skill/逆恨み.jpg"),"達人芸":I("img/templates/skill/達人芸.jpg"),"雷耐性":I("img/templates/skill/雷耐性.jpg"),"鬼火纏":I("img/templates/skill/鬼火纏.jpg"),"龍耐性":I("img/templates/skill/龍耐性.jpg"),"ブレ抑制":I("img/templates/skill/ブレ抑制.jpg"),"ランナー":I("img/templates/skill/ランナー.jpg"),"乗り名人":I("img/templates/skill/乗り名人.jpg"),"剛刃研磨":I("img/templates/skill/剛刃研磨.jpg"),"力の解放":I("img/templates/skill/力の解放.jpg"),"反動軽減":I("img/templates/skill/反動軽減.jpg"),"回復速度":I("img/templates/skill/回復速度.jpg"),"回避性能":I("img/templates/skill/回避性能.jpg"),"壁面移動":I("img/templates/skill/壁面移動.jpg"),"弱点特効":I("img/templates/skill/弱点特効.jpg"),"強化持続":I("img/templates/skill/強化持続.jpg"),"弾丸節約":I("img/templates/skill/弾丸節約.jpg"),"弾導強化":I("img/templates/skill/弾導強化.jpg"),"死中に活":I("img/templates/skill/死中に活.jpg"),"気絶耐性":I("img/templates/skill/気絶耐性.jpg"),"泡沫の舞":I("img/templates/skill/泡沫の舞.jpg"),"泥雪耐性":I("img/templates/skill/泥雪耐性.jpg"),"滑走強化":I("img/templates/skill/滑走強化.jpg"),"火事場力":I("img/templates/skill/火事場力.jpg"),"睡眠耐性":I("img/templates/skill/睡眠耐性.jpg"),"砲弾装填":I("img/templates/skill/砲弾装填.jpg"),"翔蟲使い":I("img/templates/skill/翔蟲使い.jpg"),"装填拡張":I("img/templates/skill/装填拡張.jpg"),"装填速度":I("img/templates/skill/装填速度.jpg"),"速射強化":I("img/templates/skill/速射強化.jpg"),"鈍器使い":I("img/templates/skill/鈍器使い.jpg"),"風圧耐性":I("img/templates/skill/風圧耐性.jpg"),"飛び込み":I("img/templates/skill/飛び込み.jpg"),"高速変形":I("img/templates/skill/高速変形.jpg"),"麻痺耐性":I("img/templates/skill/麻痺耐性.jpg"),"回避距離UP":I("img/templates/skill/回避距離UP.jpg"),"ひるみ軽減":I("img/templates/skill/ひるみ軽減.jpg"),"ガード強化":I("img/templates/skill/ガード強化.jpg"),"ガード性能":I("img/templates/skill/ガード性能.jpg"),"攻めの守勢":I("img/templates/skill/攻めの守勢.jpg"),"毒属性強化":I("img/templates/skill/毒属性強化.jpg"),"笛吹き名人":I("img/templates/skill/笛吹き名人.jpg"),"精霊の加護":I("img/templates/skill/精霊の加護.jpg"),"腹減り耐性":I("img/templates/skill/腹減り耐性.jpg"),"体力回復量UP":I("img/templates/skill/体力回復量UP.jpg"),"キノコ大好き":I("img/templates/skill/キノコ大好き.jpg"),"ジャンプ鉄人":I("img/templates/skill/ジャンプ鉄人.jpg"),"スタミナ奪取":I("img/templates/skill/スタミナ奪取.jpg"),"フルチャージ":I("img/templates/skill/フルチャージ.jpg"),"剥ぎ取り鉄人":I("img/templates/skill/剥ぎ取り鉄人.jpg"),"抜刀術【力】":I("img/templates/skill/抜刀術【力】.jpg"),"抜刀術【技】":I("img/templates/skill/抜刀術【技】.jpg"),"爆破属性強化":I("img/templates/skill/爆破属性強化.jpg"),"特殊射撃強化":I("img/templates/skill/特殊射撃強化.jpg"),"睡眠属性強化":I("img/templates/skill/睡眠属性強化.jpg"),"麻痺属性強化":I("img/templates/skill/麻痺属性強化.jpg"),"会心撃【属性】":I("img/templates/skill/会心撃【属性】.jpg"),"属性やられ耐性":I("img/templates/skill/属性やられ耐性.jpg"),"水属性攻撃強化":I("img/templates/skill/水属性攻撃強化.jpg"),"氷属性攻撃強化":I("img/templates/skill/氷属性攻撃強化.jpg"),"火属性攻撃強化":I("img/templates/skill/火属性攻撃強化.jpg"),"爆破やられ耐性":I("img/templates/skill/爆破やられ耐性.jpg"),"砥石使用高速化":I("img/templates/skill/砥石使用高速化.jpg"),"雷属性攻撃強化":I("img/templates/skill/雷属性攻撃強化.jpg"),"龍属性攻撃強化":I("img/templates/skill/龍属性攻撃強化.jpg"),"アイテム使用強化":I("img/templates/skill/アイテム使用強化.jpg"),"スタミナ急速回復":I("img/templates/skill/スタミナ急速回復.jpg"),"散弾・拡散矢強化":I("img/templates/skill/散弾・拡散矢強化.jpg"),"貫通弾・貫通矢強化":I("img/templates/skill/貫通弾・貫通矢強化.jpg"),"通常弾・連射矢強化":I("img/templates/skill/通常弾・連射矢強化.jpg")}},this.templates.page={};for(let t=1;t<=this.MAX_PAGE;t++)this.templates.page[t]=I(`img/templates/page/${t}.png`);this.templates=await R(this.templates)}scan(t){const e=this._getCurrentPage(t),[l,s]=this._getCurrentCharmPos(t),[i,m]=l,p=this._getRarity(t),n=this._getSlots(t),g=this._getSkills(t),a=this._getSkillLevels(t);console.log({col:i,row:m,match:s,page:e,rarity:p,slots:n,skills:g,skillLevels:a})}_getRarity(t){return x(t,this.templates.rare,this.POINT_RARITY,63,63)}_getSlots(t){return x(t,this.templates.slot,this.POINT_SLOTS,0,63)}_getSkills(t){return[x(t,this.templates.skill,this.POINT_SKILL1,0,63),x(t,this.templates.skill,this.POINT_SKILL2,0,63)]}_getSkillLevels(t){return[x(t,this.templates.lvl,this.POINT_SKILL_LEVEL1,0,63),x(t,this.templates.lvl,this.POINT_SKILL_LEVEL2,0,63)]}_getCurrentPage(t){return x(t,this.templates.page,this.POINT_PAGE,31,63)}_getCurrentCharmPos(t){const e=new cv.Rect(this.POINT_CHARM_AREA_LEFT_TOP,this.SIZE_CHARM_AREA),l=t.roi(e),s=new cv.Mat;cv.matchTemplate(l,this.templates.frame,s,cv.TM_CCOEFF_NORMED);const{maxLoc:i,maxVal:m}=cv.minMaxLoc(s);return s.delete(),l.delete(),[[1+Math.floor(.5+i.x/36),1+Math.floor(.5+i.y/41)],m]}}const N=[];function C(t){let e,l,s,i,m,p;return{c(){e=o("video"),l=o("track"),i=r(),m=o("p"),p=o("progress"),u(l,"kind","captions"),u(e,"class","preview svelte-mz6jzx"),e.src!==(s=t[3])&&u(e,"src",s),u(e,"alt","preview"),p.value=t[4],u(p,"class","svelte-mz6jzx")},m(s,a){g(s,e,a),n(e,l),t[7](e),g(s,i,a),g(s,m,a),n(m,p)},p(t,l){8&l&&e.src!==(s=t[3])&&u(e,"src",s),16&l&&(p.value=t[4])},d(l){l&&a(e),t[7](null),l&&a(i),l&&a(m)}}}function M(e){let l,i,m,p,j,k,f,h,d,v,_,P,w,$=e[3]&&C(e);return{c(){var t,e,s;l=o("main"),i=o("h1"),i.textContent=`${z}`,m=r(),$&&$.c(),p=r(),j=o("div"),k=o("input"),f=r(),h=o("img"),v=r(),_=o("div"),_.textContent="Choose Movie",u(i,"class","svelte-mz6jzx"),t="display",e="none",k.style.setProperty(t,e,s?"important":""),u(k,"type","file"),u(k,"accept",".mp4"),u(k,"class","svelte-mz6jzx"),h.src!==(d="https://static.thenounproject.com/png/625182-200.png")&&u(h,"src","https://static.thenounproject.com/png/625182-200.png"),u(h,"alt",""),u(h,"class","svelte-mz6jzx"),u(_,"class","svelte-mz6jzx"),u(j,"class","upload svelte-mz6jzx"),u(l,"class","svelte-mz6jzx")},m(t,s){g(t,l,s),n(l,i),n(l,m),$&&$.m(l,null),n(l,p),n(l,j),n(j,k),e[10](k),n(j,f),n(j,h),n(j,v),n(j,_),P||(w=[c(k,"change",e[8]),c(k,"change",e[9]),c(h,"click",e[11]),c(_,"click",e[12])],P=!0)},p(t,[e]){t[3]?$?$.p(t,e):($=C(t),$.c(),$.m(l,p)):$&&($.d(1),$=null)},i:t,o:t,d(t){t&&a(l),$&&$.d(),e[10](null),P=!1,s(w)}}}const z="MHRise Charm Scanner";function K(e,l,s){let i,n,g,a,o,r,c;const u=function(e,l=t){let s;const i=[];function p(t){if(m(e,t)&&(e=t,s)){const t=!N.length;for(let t=0;t<i.length;t+=1){const l=i[t];l[1](),N.push(l,e)}if(t){for(let t=0;t<N.length;t+=2)N[t][0](N[t+1]);N.length=0}}}return{set:p,update:function(t){p(t(e))},subscribe:function(m,n=t){const g=[m,n];return i.push(g),1===i.length&&(s=l(p)||t),m(e),()=>{const t=i.indexOf(g);-1!==t&&i.splice(t,1),0===i.length&&(s(),s=null)}}}}(0);p(e,u,(t=>s(4,i=t)));const j=async t=>{const e=t.target.files;if(e&&e[0]){const t=new FileReader;t.readAsDataURL(e[0]),await new Promise((e=>{t.onload=e})),s(3,r=t.result),await new Promise((t=>setTimeout(t,50))),s(2,o.width=1280,o),s(2,o.height=720,o),await new Promise((t=>o.addEventListener("canplay",t))),c=new cv.VideoCapture(o);const l=new cv.Mat(720,1280,cv.CV_8UC4);await new Promise((t=>setTimeout(t,200)));const i=1/30;for(;o.duration!=o.currentTime;)c.read(l),n.scan(l),u.set(o.currentTime/o.duration),s(2,o.currentTime=Math.min(o.duration,o.currentTime+i),o),await new Promise((t=>setTimeout(t,0)));u.set(1),l.delete()}};setTimeout((async()=>{n=new S,await n.init()}),1e3);return[g,a,o,r,i,u,j,function(t){h[t?"unshift":"push"]((()=>{o=t,s(2,o)}))},t=>j(t),function(){a=this.files,s(1,a)},function(t){h[t?"unshift":"push"]((()=>{g=t,s(0,g)}))},()=>{g.click()},()=>{g.click()}]}return new class extends class{$destroy(){!function(t,e){const l=t.$$;null!==l.fragment&&(s(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const l=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return l.push(e),()=>{const t=l.indexOf(e);-1!==t&&l.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),A(this,t,K,M,m,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
