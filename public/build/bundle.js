var app=function(){"use strict";function t(){}function e(t){return t()}function i(){return Object.create(null)}function a(t){t.forEach(e)}function l(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function p(e,i,a){e.$$.on_destroy.push(function(e,...i){if(null==e)return t;const a=e.subscribe(...i);return a.unsubscribe?()=>a.unsubscribe():a}(i,a))}function m(t,e){t.appendChild(e)}function n(t,e,i){t.insertBefore(e,i||null)}function g(t){t.parentNode.removeChild(t)}function o(t){return document.createElement(t)}function r(){return t=" ",document.createTextNode(t);var t}function c(t,e,i,a){return t.addEventListener(e,i,a),()=>t.removeEventListener(e,i,a)}function w(t,e,i){null==i?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}let u;function j(t){u=t}const k=[],f=[],h=[],d=[],v=Promise.resolve();let _=!1;function P(t){h.push(t)}let $=!1;const T=new Set;function L(){if(!$){$=!0;do{for(let t=0;t<k.length;t+=1){const e=k[t];j(e),E(e.$$)}for(j(null),k.length=0;f.length;)f.pop()();for(let t=0;t<h.length;t+=1){const e=h[t];T.has(e)||(T.add(e),e())}h.length=0}while(k.length);for(;d.length;)d.pop()();_=!1,$=!1,T.clear()}}function E(t){if(null!==t.fragment){t.update(),a(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(P)}}const y=new Set;function I(t,e){-1===t.$$.dirty[0]&&(k.push(t),_||(_=!0,v.then(L)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function b(s,p,m,n,o,r,c=[-1]){const w=u;j(s);const k=s.$$={fragment:null,ctx:null,props:r,update:t,not_equal:o,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(w?w.$$.context:p.context||[]),callbacks:i(),dirty:c,skip_bound:!1};let f=!1;if(k.ctx=m?m(s,p.props||{},((t,e,...i)=>{const a=i.length?i[0]:e;return k.ctx&&o(k.ctx[t],k.ctx[t]=a)&&(!k.skip_bound&&k.bound[t]&&k.bound[t](a),f&&I(s,t)),e})):[],k.update(),f=!0,a(k.before_update),k.fragment=!!n&&n(k.ctx),p.target){if(p.hydrate){const t=function(t){return Array.from(t.childNodes)}(p.target);k.fragment&&k.fragment.l(t),t.forEach(g)}else k.fragment&&k.fragment.c();p.intro&&((h=s.$$.fragment)&&h.i&&(y.delete(h),h.i(d))),function(t,i,s,p){const{fragment:m,on_mount:n,on_destroy:g,after_update:o}=t.$$;m&&m.m(i,s),p||P((()=>{const i=n.map(e).filter(l);g?g.push(...i):a(i),t.$$.on_mount=[]})),o.forEach(P)}(s,p.target,p.anchor,p.customElement),L()}var h,d;j(w)}function O(t){return new Promise((e=>{const i=new Image;i.src=t,i.onload=()=>{const t=cv.imread(i);e(t)}}))}function A(t,e,i,a,l){const s=new cv.Size(e.cols,e.rows),p=new cv.Rect(i,s),m=t.roi(p),n=new cv.Mat;cv.threshold(e,n,a,255,cv.THRESH_BINARY);const g=new cv.Mat;m.copyTo(g,n);const o=new cv.Mat;cv.absdiff(e,g,o),cv.cvtColor(o,o,cv.COLOR_BGR2GRAY);const r=new cv.Mat;return cv.threshold(o,r,l,255,cv.THRESH_BINARY),o.delete(),g.delete(),n.delete(),m.delete(),r}function x(t,e,i,a=63,l=63){let s=Number.MAX_SAFE_INTEGER,p=null;for(const[m,n]of Object.entries(e)){const e=A(t,n,i,a,l),g=cv.countNonZero(e);s>g&&(s=g,p=m),e.delete()}return p}class R{MAX_PAGE=34;POINT_RARITY=new cv.Point(1190,176);POINT_SLOTS=new cv.Point(1160,200);POINT_SKILL1=new cv.Point(1033,266);POINT_SKILL2=new cv.Point(1033,317);POINT_SKILL_LEVEL1=new cv.Point(1190,289);POINT_SKILL_LEVEL2=new cv.Point(1190,340);POINT_PAGE=new cv.Point(787,582);POINT_CHARM_AREA_LEFT_TOP=new cv.Point(635,359);SIZE_CHARM_AREA=new cv.Size(356,199);templates=null;async init(){this.templates={frame:await O("img/templates/frame.png"),rare:{7:await O("img/templates/rare/7.jpg"),6:await O("img/templates/rare/6.jpg"),5:await O("img/templates/rare/5.jpg"),4:await O("img/templates/rare/4.jpg")},lvl:{0:await O("img/templates/lvl/0.jpg"),1:await O("img/templates/lvl/1.jpg"),2:await O("img/templates/lvl/2.jpg"),3:await O("img/templates/lvl/3.jpg"),4:await O("img/templates/lvl/4.jpg"),5:await O("img/templates/lvl/5.jpg")},slot:{0:await O("img/templates/slot/0.jpg"),1:await O("img/templates/slot/1.jpg"),11:await O("img/templates/slot/11.jpg"),111:await O("img/templates/slot/111.jpg"),2:await O("img/templates/slot/2.jpg"),21:await O("img/templates/slot/21.jpg"),211:await O("img/templates/slot/211.jpg"),22:await O("img/templates/slot/22.jpg"),221:await O("img/templates/slot/221.jpg"),3:await O("img/templates/slot/3.jpg"),31:await O("img/templates/slot/31.jpg"),311:await O("img/templates/slot/311.jpg"),32:await O("img/templates/slot/32.jpg"),321:await O("img/templates/slot/321.jpg")},skill:{"KO術":await O("img/templates/skill/KO術.jpg"),"匠":await O("img/templates/skill/匠.jpg"),"不屈":await O("img/templates/skill/不屈.jpg"),"体術":await O("img/templates/skill/体術.jpg"),"幸運":await O("img/templates/skill/幸運.jpg"),"心眼":await O("img/templates/skill/心眼.jpg"),"攻撃":await O("img/templates/skill/攻撃.jpg"),"業物":await O("img/templates/skill/業物.jpg"),"渾身":await O("img/templates/skill/渾身.jpg"),"無し":await O("img/templates/skill/無し.jpg"),"砲術":await O("img/templates/skill/砲術.jpg"),"耐震":await O("img/templates/skill/耐震.jpg"),"耳栓":await O("img/templates/skill/耳栓.jpg"),"逆襲":await O("img/templates/skill/逆襲.jpg"),"防御":await O("img/templates/skill/防御.jpg"),"陽動":await O("img/templates/skill/陽動.jpg"),"集中":await O("img/templates/skill/集中.jpg"),"ボマー":await O("img/templates/skill/ボマー.jpg"),"地質学":await O("img/templates/skill/地質学.jpg"),"広域化":await O("img/templates/skill/広域化.jpg"),"挑戦者":await O("img/templates/skill/挑戦者.jpg"),"早食い":await O("img/templates/skill/早食い.jpg"),"植生学":await O("img/templates/skill/植生学.jpg"),"毒耐性":await O("img/templates/skill/毒耐性.jpg"),"水耐性":await O("img/templates/skill/水耐性.jpg"),"氷耐性":await O("img/templates/skill/氷耐性.jpg"),"満足感":await O("img/templates/skill/満足感.jpg"),"火耐性":await O("img/templates/skill/火耐性.jpg"),"破壊王":await O("img/templates/skill/破壊王.jpg"),"納刀術":await O("img/templates/skill/納刀術.jpg"),"見切り":await O("img/templates/skill/見切り.jpg"),"超会心":await O("img/templates/skill/超会心.jpg"),"逆恨み":await O("img/templates/skill/逆恨み.jpg"),"達人芸":await O("img/templates/skill/達人芸.jpg"),"雷耐性":await O("img/templates/skill/雷耐性.jpg"),"鬼火纏":await O("img/templates/skill/鬼火纏.jpg"),"龍耐性":await O("img/templates/skill/龍耐性.jpg"),"ブレ抑制":await O("img/templates/skill/ブレ抑制.jpg"),"ランナー":await O("img/templates/skill/ランナー.jpg"),"乗り名人":await O("img/templates/skill/乗り名人.jpg"),"剛刃研磨":await O("img/templates/skill/剛刃研磨.jpg"),"力の解放":await O("img/templates/skill/力の解放.jpg"),"反動軽減":await O("img/templates/skill/反動軽減.jpg"),"回復速度":await O("img/templates/skill/回復速度.jpg"),"回避性能":await O("img/templates/skill/回避性能.jpg"),"壁面移動":await O("img/templates/skill/壁面移動.jpg"),"弱点特効":await O("img/templates/skill/弱点特効.jpg"),"強化持続":await O("img/templates/skill/強化持続.jpg"),"弾丸節約":await O("img/templates/skill/弾丸節約.jpg"),"弾導強化":await O("img/templates/skill/弾導強化.jpg"),"死中に活":await O("img/templates/skill/死中に活.jpg"),"気絶耐性":await O("img/templates/skill/気絶耐性.jpg"),"泡沫の舞":await O("img/templates/skill/泡沫の舞.jpg"),"泥雪耐性":await O("img/templates/skill/泥雪耐性.jpg"),"滑走強化":await O("img/templates/skill/滑走強化.jpg"),"火事場力":await O("img/templates/skill/火事場力.jpg"),"睡眠耐性":await O("img/templates/skill/睡眠耐性.jpg"),"砲弾装填":await O("img/templates/skill/砲弾装填.jpg"),"翔蟲使い":await O("img/templates/skill/翔蟲使い.jpg"),"装填拡張":await O("img/templates/skill/装填拡張.jpg"),"装填速度":await O("img/templates/skill/装填速度.jpg"),"速射強化":await O("img/templates/skill/速射強化.jpg"),"鈍器使い":await O("img/templates/skill/鈍器使い.jpg"),"風圧耐性":await O("img/templates/skill/風圧耐性.jpg"),"飛び込み":await O("img/templates/skill/飛び込み.jpg"),"高速変形":await O("img/templates/skill/高速変形.jpg"),"麻痺耐性":await O("img/templates/skill/麻痺耐性.jpg"),"回避距離UP":await O("img/templates/skill/回避距離UP.jpg"),"ひるみ軽減":await O("img/templates/skill/ひるみ軽減.jpg"),"ガード強化":await O("img/templates/skill/ガード強化.jpg"),"ガード性能":await O("img/templates/skill/ガード性能.jpg"),"攻めの守勢":await O("img/templates/skill/攻めの守勢.jpg"),"毒属性強化":await O("img/templates/skill/毒属性強化.jpg"),"笛吹き名人":await O("img/templates/skill/笛吹き名人.jpg"),"精霊の加護":await O("img/templates/skill/精霊の加護.jpg"),"腹減り耐性":await O("img/templates/skill/腹減り耐性.jpg"),"体力回復量UP":await O("img/templates/skill/体力回復量UP.jpg"),"キノコ大好き":await O("img/templates/skill/キノコ大好き.jpg"),"ジャンプ鉄人":await O("img/templates/skill/ジャンプ鉄人.jpg"),"スタミナ奪取":await O("img/templates/skill/スタミナ奪取.jpg"),"フルチャージ":await O("img/templates/skill/フルチャージ.jpg"),"剥ぎ取り鉄人":await O("img/templates/skill/剥ぎ取り鉄人.jpg"),"抜刀術【力】":await O("img/templates/skill/抜刀術【力】.jpg"),"抜刀術【技】":await O("img/templates/skill/抜刀術【技】.jpg"),"爆破属性強化":await O("img/templates/skill/爆破属性強化.jpg"),"特殊射撃強化":await O("img/templates/skill/特殊射撃強化.jpg"),"睡眠属性強化":await O("img/templates/skill/睡眠属性強化.jpg"),"麻痺属性強化":await O("img/templates/skill/麻痺属性強化.jpg"),"会心撃【属性】":await O("img/templates/skill/会心撃【属性】.jpg"),"属性やられ耐性":await O("img/templates/skill/属性やられ耐性.jpg"),"水属性攻撃強化":await O("img/templates/skill/水属性攻撃強化.jpg"),"氷属性攻撃強化":await O("img/templates/skill/氷属性攻撃強化.jpg"),"火属性攻撃強化":await O("img/templates/skill/火属性攻撃強化.jpg"),"爆破やられ耐性":await O("img/templates/skill/爆破やられ耐性.jpg"),"砥石使用高速化":await O("img/templates/skill/砥石使用高速化.jpg"),"雷属性攻撃強化":await O("img/templates/skill/雷属性攻撃強化.jpg"),"龍属性攻撃強化":await O("img/templates/skill/龍属性攻撃強化.jpg"),"アイテム使用強化":await O("img/templates/skill/アイテム使用強化.jpg"),"スタミナ急速回復":await O("img/templates/skill/スタミナ急速回復.jpg"),"散弾・拡散矢強化":await O("img/templates/skill/散弾・拡散矢強化.jpg"),"貫通弾・貫通矢強化":await O("img/templates/skill/貫通弾・貫通矢強化.jpg"),"通常弾・連射矢強化":await O("img/templates/skill/通常弾・連射矢強化.jpg")}},this.templates.page={};for(let t=1;t<=this.MAX_PAGE;t++)this.templates.page[t]=await O(`img/templates/page/${t}.png`)}scan(t){const e=this._getCurrentPage(t),[i,a]=this._getCurrentCharmPos(t),[l,s]=i,p=this._getRarity(t),m=this._getSlots(t),n=this._getSkills(t),g=this._getSkillLevels(t);console.log({col:l,row:s,match:a,page:e,rarity:p,slots:m,skills:n,skillLevels:g})}_getRarity(t){return x(t,this.templates.rare,this.POINT_RARITY,63,63)}_getSlots(t){return x(t,this.templates.slot,this.POINT_SLOTS,0,63)}_getSkills(t){return[x(t,this.templates.skill,this.POINT_SKILL1,0,63),x(t,this.templates.skill,this.POINT_SKILL2,0,63)]}_getSkillLevels(t){return[x(t,this.templates.lvl,this.POINT_SKILL_LEVEL1,0,63),x(t,this.templates.lvl,this.POINT_SKILL_LEVEL2,0,63)]}_getCurrentPage(t){return x(t,this.templates.page,this.POINT_PAGE,31,63)}_getCurrentCharmPos(t){const e=new cv.Rect(this.POINT_CHARM_AREA_LEFT_TOP,this.SIZE_CHARM_AREA),i=t.roi(e),a=new cv.Mat;cv.matchTemplate(i,this.templates.frame,a,cv.TM_CCOEFF_NORMED);const{maxLoc:l,maxVal:s}=cv.minMaxLoc(a);return a.delete(),i.delete(),[[1+Math.floor(.5+l.x/36),1+Math.floor(.5+l.y/41)],s]}}const S=[];function N(t){let e,i,a,l,s,p;return{c(){e=o("video"),i=o("track"),l=r(),s=o("p"),p=o("progress"),w(i,"kind","captions"),w(e,"class","preview svelte-mz6jzx"),e.src!==(a=t[3])&&w(e,"src",a),w(e,"alt","preview"),p.value=t[4],w(p,"class","svelte-mz6jzx")},m(a,g){n(a,e,g),m(e,i),t[7](e),n(a,l,g),n(a,s,g),m(s,p)},p(t,i){8&i&&e.src!==(a=t[3])&&w(e,"src",a),16&i&&(p.value=t[4])},d(i){i&&g(e),t[7](null),i&&g(l),i&&g(s)}}}function C(e){let i,l,s,p,u,j,k,f,h,d,v,_,P,$=e[3]&&N(e);return{c(){var t,e,a;i=o("main"),l=o("h1"),l.textContent=`${M}`,s=r(),$&&$.c(),p=r(),u=o("div"),j=o("input"),k=r(),f=o("img"),d=r(),v=o("div"),v.textContent="Choose Movie",w(l,"class","svelte-mz6jzx"),t="display",e="none",j.style.setProperty(t,e,a?"important":""),w(j,"type","file"),w(j,"accept",".mp4"),w(j,"class","svelte-mz6jzx"),f.src!==(h="https://static.thenounproject.com/png/625182-200.png")&&w(f,"src","https://static.thenounproject.com/png/625182-200.png"),w(f,"alt",""),w(f,"class","svelte-mz6jzx"),w(v,"class","svelte-mz6jzx"),w(u,"class","upload svelte-mz6jzx"),w(i,"class","svelte-mz6jzx")},m(t,a){n(t,i,a),m(i,l),m(i,s),$&&$.m(i,null),m(i,p),m(i,u),m(u,j),e[10](j),m(u,k),m(u,f),m(u,d),m(u,v),_||(P=[c(j,"change",e[8]),c(j,"change",e[9]),c(f,"click",e[11]),c(v,"click",e[12])],_=!0)},p(t,[e]){t[3]?$?$.p(t,e):($=N(t),$.c(),$.m(i,p)):$&&($.d(1),$=null)},i:t,o:t,d(t){t&&g(i),$&&$.d(),e[10](null),_=!1,a(P)}}}const M="MHRise Charm Scanner";function z(e,i,a){let l,m,n,g,o,r,c;const w=function(e,i=t){let a;const l=[];function p(t){if(s(e,t)&&(e=t,a)){const t=!S.length;for(let t=0;t<l.length;t+=1){const i=l[t];i[1](),S.push(i,e)}if(t){for(let t=0;t<S.length;t+=2)S[t][0](S[t+1]);S.length=0}}}return{set:p,update:function(t){p(t(e))},subscribe:function(s,m=t){const n=[s,m];return l.push(n),1===l.length&&(a=i(p)||t),s(e),()=>{const t=l.indexOf(n);-1!==t&&l.splice(t,1),0===l.length&&(a(),a=null)}}}}(0);p(e,w,(t=>a(4,l=t)));const u=async t=>{const e=t.target.files;if(e&&e[0]){const t=new FileReader;t.readAsDataURL(e[0]),await new Promise((e=>{t.onload=e})),a(3,r=t.result),await new Promise((t=>setTimeout(t,50))),a(2,o.width=1280,o),a(2,o.height=720,o),await new Promise((t=>o.addEventListener("canplay",t))),c=new cv.VideoCapture(o);const i=new cv.Mat(720,1280,cv.CV_8UC4);await new Promise((t=>setTimeout(t,200)));const l=1/30;for(;o.duration!=o.currentTime;)c.read(i),m.scan(i),w.set(o.currentTime/o.duration),a(2,o.currentTime=Math.min(o.duration,o.currentTime+l),o),await new Promise((t=>setTimeout(t,0)));w.set(1),i.delete()}};setTimeout((async()=>{m=new R,await m.init()}),1e3);return[n,g,o,r,l,w,u,function(t){f[t?"unshift":"push"]((()=>{o=t,a(2,o)}))},t=>u(t),function(){g=this.files,a(1,g)},function(t){f[t?"unshift":"push"]((()=>{n=t,a(0,n)}))},()=>{n.click()},()=>{n.click()}]}return new class extends class{$destroy(){!function(t,e){const i=t.$$;null!==i.fragment&&(a(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),b(this,t,z,C,s,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
