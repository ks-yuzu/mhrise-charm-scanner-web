var app=function(){"use strict";function t(){}function e(t){return t()}function l(){return Object.create(null)}function s(t){t.forEach(e)}function i(t){return"function"==typeof t}function n(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function m(e,l,s){e.$$.on_destroy.push(function(e,...l){if(null==e)return t;const s=e.subscribe(...l);return s.unsubscribe?()=>s.unsubscribe():s}(l,s))}function p(t,e){t.appendChild(e)}function g(t,e,l){t.insertBefore(e,l||null)}function a(t){t.parentNode.removeChild(t)}function o(t){return document.createElement(t)}function r(t){return document.createTextNode(t)}function c(){return r(" ")}function u(t,e,l,s){return t.addEventListener(e,l,s),()=>t.removeEventListener(e,l,s)}function j(t,e,l){null==l?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}let k;function h(t){k=t}const f=[],d=[],_=[],v=[],P=Promise.resolve();let E=!1;function w(t){_.push(t)}let $=!1;const L=new Set;function b(){if(!$){$=!0;do{for(let t=0;t<f.length;t+=1){const e=f[t];h(e),T(e.$$)}for(h(null),f.length=0;d.length;)d.pop()();for(let t=0;t<_.length;t+=1){const e=_[t];L.has(e)||(L.add(e),e())}_.length=0}while(f.length);for(;v.length;)v.pop()();E=!1,$=!1,L.clear()}}function T(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const A=new Set;function y(t,e){-1===t.$$.dirty[0]&&(f.push(t),E||(E=!0,P.then(b)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function O(n,m,p,g,o,r,c=[-1]){const u=k;h(n);const j=n.$$={fragment:null,ctx:null,props:r,update:t,not_equal:o,bound:l(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:m.context||[]),callbacks:l(),dirty:c,skip_bound:!1};let f=!1;if(j.ctx=p?p(n,m.props||{},((t,e,...l)=>{const s=l.length?l[0]:e;return j.ctx&&o(j.ctx[t],j.ctx[t]=s)&&(!j.skip_bound&&j.bound[t]&&j.bound[t](s),f&&y(n,t)),e})):[],j.update(),f=!0,s(j.before_update),j.fragment=!!g&&g(j.ctx),m.target){if(m.hydrate){const t=function(t){return Array.from(t.childNodes)}(m.target);j.fragment&&j.fragment.l(t),t.forEach(a)}else j.fragment&&j.fragment.c();m.intro&&((d=n.$$.fragment)&&d.i&&(A.delete(d),d.i(_))),function(t,l,n,m){const{fragment:p,on_mount:g,on_destroy:a,after_update:o}=t.$$;p&&p.m(l,n),m||w((()=>{const l=g.map(e).filter(i);a?a.push(...l):s(l),t.$$.on_mount=[]})),o.forEach(w)}(n,m.target,m.anchor,m.customElement),b()}var d,_;h(u)}function R(t){return new Promise((e=>{const l=new Image;l.src=t,l.onload=()=>{const t=cv.imread(l);e(t)}}))}function S(t,e,l,s,i){const n=new cv.Size(e.cols,e.rows),m=new cv.Rect(l,n),p=t.roi(m),g=new cv.Mat;cv.threshold(e,g,s,255,cv.THRESH_BINARY);const a=new cv.Mat;p.copyTo(a,g);const o=new cv.Mat;cv.absdiff(e,a,o),cv.cvtColor(o,o,cv.COLOR_BGR2GRAY);const r=new cv.Mat;return cv.threshold(o,r,i,255,cv.THRESH_BINARY),o.delete(),a.delete(),g.delete(),p.delete(),r}function I(t,e,l,s=63,i=63){let n=Number.MAX_SAFE_INTEGER,m=null;for(const[p,g]of Object.entries(e)){const e=S(t,g,l,s,i),a=cv.countNonZero(e);n>a&&(n=a,m=p),e.delete()}return m}function M(t){return t instanceof Promise?t:Array.isArray(t)?Promise.all(t.map(M)):"object"==typeof t?function(t){const e=Object.keys(t).map((e=>M(t[e]).then((t=>({key:e,value:t})))));return Promise.all(e).then((t=>t.reduce(((t,e)=>(t[e.key]=e.value,t)),{})))}(t):Promise.resolve(t)}class N{MAX_PAGE=34;COLUMNS_PER_PAGE=10;ROWS_PER_PAGE=5;POINT_RARITY=new cv.Point(1190,176);POINT_SLOTS=new cv.Point(1160,200);POINT_SKILL1=new cv.Point(1033,266);POINT_SKILL2=new cv.Point(1033,317);POINT_SKILL_LEVEL1=new cv.Point(1190,289);POINT_SKILL_LEVEL2=new cv.Point(1190,340);POINT_PAGE=new cv.Point(787,582);POINT_CHARM_AREA_LEFT_TOP=new cv.Point(634,359);SIZE_CHARM_AREA=new cv.Size(357,199);charms={};templates=null;async init(){this.templates={frame:R("img/templates/frame.png"),rare:{7:R("img/templates/rare/7.jpg"),6:R("img/templates/rare/6.jpg"),5:R("img/templates/rare/5.jpg"),4:R("img/templates/rare/4.jpg")},lvl:{0:R("img/templates/lvl/0.jpg"),1:R("img/templates/lvl/1.jpg"),2:R("img/templates/lvl/2.jpg"),3:R("img/templates/lvl/3.jpg"),4:R("img/templates/lvl/4.jpg"),5:R("img/templates/lvl/5.jpg")},slot:{"0-0-0":R("img/templates/slot/0.jpg"),"1-0-0":R("img/templates/slot/1.jpg"),"1-1-0":R("img/templates/slot/11.jpg"),"1-1-1":R("img/templates/slot/111.jpg"),"2-0-0":R("img/templates/slot/2.jpg"),"2-1-0":R("img/templates/slot/21.jpg"),"2-1-1":R("img/templates/slot/211.jpg"),"2-2-0":R("img/templates/slot/22.jpg"),"2-2-1":R("img/templates/slot/221.jpg"),"3-0-0":R("img/templates/slot/3.jpg"),"3-1-0":R("img/templates/slot/31.jpg"),"3-1-1":R("img/templates/slot/311.jpg"),"3-2-0":R("img/templates/slot/32.jpg"),"3-2-1":R("img/templates/slot/321.jpg")},skill:{"KO術":R("img/templates/skill/KO術.jpg"),"匠":R("img/templates/skill/匠.jpg"),"不屈":R("img/templates/skill/不屈.jpg"),"体術":R("img/templates/skill/体術.jpg"),"幸運":R("img/templates/skill/幸運.jpg"),"心眼":R("img/templates/skill/心眼.jpg"),"攻撃":R("img/templates/skill/攻撃.jpg"),"業物":R("img/templates/skill/業物.jpg"),"渾身":R("img/templates/skill/渾身.jpg"),"無し":R("img/templates/skill/無し.jpg"),"砲術":R("img/templates/skill/砲術.jpg"),"耐震":R("img/templates/skill/耐震.jpg"),"耳栓":R("img/templates/skill/耳栓.jpg"),"逆襲":R("img/templates/skill/逆襲.jpg"),"防御":R("img/templates/skill/防御.jpg"),"陽動":R("img/templates/skill/陽動.jpg"),"集中":R("img/templates/skill/集中.jpg"),"ボマー":R("img/templates/skill/ボマー.jpg"),"地質学":R("img/templates/skill/地質学.jpg"),"広域化":R("img/templates/skill/広域化.jpg"),"挑戦者":R("img/templates/skill/挑戦者.jpg"),"早食い":R("img/templates/skill/早食い.jpg"),"植生学":R("img/templates/skill/植生学.jpg"),"毒耐性":R("img/templates/skill/毒耐性.jpg"),"水耐性":R("img/templates/skill/水耐性.jpg"),"氷耐性":R("img/templates/skill/氷耐性.jpg"),"満足感":R("img/templates/skill/満足感.jpg"),"火耐性":R("img/templates/skill/火耐性.jpg"),"破壊王":R("img/templates/skill/破壊王.jpg"),"納刀術":R("img/templates/skill/納刀術.jpg"),"見切り":R("img/templates/skill/見切り.jpg"),"超会心":R("img/templates/skill/超会心.jpg"),"逆恨み":R("img/templates/skill/逆恨み.jpg"),"達人芸":R("img/templates/skill/達人芸.jpg"),"雷耐性":R("img/templates/skill/雷耐性.jpg"),"鬼火纏":R("img/templates/skill/鬼火纏.jpg"),"龍耐性":R("img/templates/skill/龍耐性.jpg"),"ブレ抑制":R("img/templates/skill/ブレ抑制.jpg"),"ランナー":R("img/templates/skill/ランナー.jpg"),"乗り名人":R("img/templates/skill/乗り名人.jpg"),"剛刃研磨":R("img/templates/skill/剛刃研磨.jpg"),"力の解放":R("img/templates/skill/力の解放.jpg"),"反動軽減":R("img/templates/skill/反動軽減.jpg"),"回復速度":R("img/templates/skill/回復速度.jpg"),"回避性能":R("img/templates/skill/回避性能.jpg"),"壁面移動":R("img/templates/skill/壁面移動.jpg"),"弱点特効":R("img/templates/skill/弱点特効.jpg"),"強化持続":R("img/templates/skill/強化持続.jpg"),"弾丸節約":R("img/templates/skill/弾丸節約.jpg"),"弾導強化":R("img/templates/skill/弾導強化.jpg"),"死中に活":R("img/templates/skill/死中に活.jpg"),"気絶耐性":R("img/templates/skill/気絶耐性.jpg"),"泡沫の舞":R("img/templates/skill/泡沫の舞.jpg"),"泥雪耐性":R("img/templates/skill/泥雪耐性.jpg"),"滑走強化":R("img/templates/skill/滑走強化.jpg"),"火事場力":R("img/templates/skill/火事場力.jpg"),"睡眠耐性":R("img/templates/skill/睡眠耐性.jpg"),"砲弾装填":R("img/templates/skill/砲弾装填.jpg"),"翔蟲使い":R("img/templates/skill/翔蟲使い.jpg"),"装填拡張":R("img/templates/skill/装填拡張.jpg"),"装填速度":R("img/templates/skill/装填速度.jpg"),"速射強化":R("img/templates/skill/速射強化.jpg"),"鈍器使い":R("img/templates/skill/鈍器使い.jpg"),"風圧耐性":R("img/templates/skill/風圧耐性.jpg"),"飛び込み":R("img/templates/skill/飛び込み.jpg"),"高速変形":R("img/templates/skill/高速変形.jpg"),"麻痺耐性":R("img/templates/skill/麻痺耐性.jpg"),"回避距離UP":R("img/templates/skill/回避距離UP.jpg"),"ひるみ軽減":R("img/templates/skill/ひるみ軽減.jpg"),"ガード強化":R("img/templates/skill/ガード強化.jpg"),"ガード性能":R("img/templates/skill/ガード性能.jpg"),"攻めの守勢":R("img/templates/skill/攻めの守勢.jpg"),"毒属性強化":R("img/templates/skill/毒属性強化.jpg"),"笛吹き名人":R("img/templates/skill/笛吹き名人.jpg"),"精霊の加護":R("img/templates/skill/精霊の加護.jpg"),"腹減り耐性":R("img/templates/skill/腹減り耐性.jpg"),"体力回復量UP":R("img/templates/skill/体力回復量UP.jpg"),"キノコ大好き":R("img/templates/skill/キノコ大好き.jpg"),"ジャンプ鉄人":R("img/templates/skill/ジャンプ鉄人.jpg"),"スタミナ奪取":R("img/templates/skill/スタミナ奪取.jpg"),"フルチャージ":R("img/templates/skill/フルチャージ.jpg"),"剥ぎ取り鉄人":R("img/templates/skill/剥ぎ取り鉄人.jpg"),"抜刀術【力】":R("img/templates/skill/抜刀術【力】.jpg"),"抜刀術【技】":R("img/templates/skill/抜刀術【技】.jpg"),"爆破属性強化":R("img/templates/skill/爆破属性強化.jpg"),"特殊射撃強化":R("img/templates/skill/特殊射撃強化.jpg"),"睡眠属性強化":R("img/templates/skill/睡眠属性強化.jpg"),"麻痺属性強化":R("img/templates/skill/麻痺属性強化.jpg"),"会心撃【属性】":R("img/templates/skill/会心撃【属性】.jpg"),"属性やられ耐性":R("img/templates/skill/属性やられ耐性.jpg"),"水属性攻撃強化":R("img/templates/skill/水属性攻撃強化.jpg"),"氷属性攻撃強化":R("img/templates/skill/氷属性攻撃強化.jpg"),"火属性攻撃強化":R("img/templates/skill/火属性攻撃強化.jpg"),"爆破やられ耐性":R("img/templates/skill/爆破やられ耐性.jpg"),"砥石使用高速化":R("img/templates/skill/砥石使用高速化.jpg"),"雷属性攻撃強化":R("img/templates/skill/雷属性攻撃強化.jpg"),"龍属性攻撃強化":R("img/templates/skill/龍属性攻撃強化.jpg"),"アイテム使用強化":R("img/templates/skill/アイテム使用強化.jpg"),"スタミナ急速回復":R("img/templates/skill/スタミナ急速回復.jpg"),"散弾・拡散矢強化":R("img/templates/skill/散弾・拡散矢強化.jpg"),"貫通弾・貫通矢強化":R("img/templates/skill/貫通弾・貫通矢強化.jpg"),"通常弾・連射矢強化":R("img/templates/skill/通常弾・連射矢強化.jpg")}},this.templates.page={};for(let t=1;t<=this.MAX_PAGE;t++)this.templates.page[t]=R(`img/templates/page/${t}.png`);this.templates=await M(this.templates),this.reset()}reset(){this.charms={};for(let t=1;t<=this.MAX_PAGE;t++){this.charms[t]={};for(let e=1;e<=this.ROWS_PER_PAGE;e++)this.charms[t][e]={}}}isScaned(t,e,l){return null!=this.charms[t][e][l]}store(t){const{page:e,row:l,col:s}=t;this.charms[e][l][s]=t}scan(t){const e=this._getCurrentPage(t),[l,s]=this._getCurrentCharmPos(t);if(s<.35)return null;const[i,n]=l;if(this.isScaned(e,n,i))return null;const m=this._getRarity(t),p=this._getSlots(t),g=this._getSkills(t),a=this._getSkillLevels(t);this.store({page:e,row:n,col:i,rarity:m,slots:p,skills:g,skillLevels:a})}exportToJson(){for(let t=1;t<=this.MAX_PAGE;t++)for(let e=1;e<=this.ROWS_PER_PAGE;e++)for(let l=1;l<=this.COLUMNS_PER_PAGE;l++){const s=this.charms[t][e][l];null!=s&&console.log(`${s.slots} ${s.skills[0]} ${s.skillLevels[0]} ${s.skills[1]} ${s.skillLevels[1]}`)}}_getRarity(t){return I(t,this.templates.rare,this.POINT_RARITY,63,63)}_getSlots(t){return I(t,this.templates.slot,this.POINT_SLOTS,0,63)}_getSkills(t){return[I(t,this.templates.skill,this.POINT_SKILL1,0,63),I(t,this.templates.skill,this.POINT_SKILL2,0,63)]}_getSkillLevels(t){return[I(t,this.templates.lvl,this.POINT_SKILL_LEVEL1,0,63),I(t,this.templates.lvl,this.POINT_SKILL_LEVEL2,0,63)]}_getCurrentPage(t){return I(t,this.templates.page,this.POINT_PAGE,31,63)}_getCurrentCharmPos(t){const e=new cv.Rect(this.POINT_CHARM_AREA_LEFT_TOP,this.SIZE_CHARM_AREA),l=t.roi(e),s=new cv.Mat;cv.matchTemplate(l,this.templates.frame,s,cv.TM_CCOEFF_NORMED);const{maxLoc:i,maxVal:n}=cv.minMaxLoc(s);return s.delete(),l.delete(),[[1+Math.floor(.5+i.x/36),1+Math.floor(.5+i.y/41)],n]}}const C=[];function x(t){let e,l,s,i,n,m,u,k,h,f,d=Math.floor(100*t[5])+"";return{c(){e=o("div"),l=o("video"),s=o("track"),n=c(),m=o("div"),u=o("progress"),k=c(),h=r(d),f=r("%"),j(s,"kind","captions"),j(l,"class","preview svelte-ugboqn"),l.src!==(i=t[4])&&j(l,"src",i),j(l,"alt","preview"),u.value=t[5],j(u,"class","svelte-ugboqn"),j(e,"id","status"),j(e,"class","svelte-ugboqn")},m(i,a){g(i,e,a),p(e,l),p(l,s),t[8](l),p(e,n),p(e,m),p(m,u),p(m,k),p(m,h),p(m,f)},p(t,e){16&e&&l.src!==(i=t[4])&&j(l,"src",i),32&e&&(u.value=t[5]),32&e&&d!==(d=Math.floor(100*t[5])+"")&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(h,d)},d(l){l&&a(e),t[8](null)}}}function G(e){let l;return{c(){l=o("div"),l.textContent="Loading Files..."},m(t,e){g(t,l,e)},p:t,d(t){t&&a(l)}}}function q(e){let l,i,n,m,r,k,h,f,d;return{c(){var t,e,s;l=o("div"),i=o("input"),n=c(),m=o("img"),k=c(),h=o("div"),h.textContent="Choose Movie",t="display",e="none",i.style.setProperty(t,e,s?"important":""),j(i,"type","file"),j(i,"accept",".mp4"),j(i,"class","svelte-ugboqn"),m.src!==(r="https://static.thenounproject.com/png/625182-200.png")&&j(m,"src","https://static.thenounproject.com/png/625182-200.png"),j(m,"alt",""),j(m,"class","svelte-ugboqn"),j(h,"class","svelte-ugboqn"),j(l,"id","upload"),j(l,"class","svelte-ugboqn")},m(t,s){g(t,l,s),p(l,i),e[11](i),p(l,n),p(l,m),p(l,k),p(l,h),f||(d=[u(i,"change",e[9]),u(i,"change",e[10]),u(m,"click",e[12]),u(h,"click",e[13])],f=!0)},p:t,d(t){t&&a(l),e[11](null),f=!1,s(d)}}}function K(e){let l,s,i,n,m=e[4]&&x(e);function r(t,e){return t[0]?q:G}let u=r(e),k=u(e);return{c(){l=o("main"),s=o("h1"),s.textContent=`${H}`,i=c(),m&&m.c(),n=c(),k.c(),j(s,"class","svelte-ugboqn"),j(l,"class","svelte-ugboqn")},m(t,e){g(t,l,e),p(l,s),p(l,i),m&&m.m(l,null),p(l,n),k.m(l,null)},p(t,[e]){t[4]?m?m.p(t,e):(m=x(t),m.c(),m.m(l,n)):m&&(m.d(1),m=null),u===(u=r(t))&&k?k.p(t,e):(k.d(1),k=u(t),k&&(k.c(),k.m(l,null)))},i:t,o:t,d(t){t&&a(l),m&&m.d(),k.d()}}}const H="MHRise Charm Scanner";function U(e,l,s){let i,p,g,a,o,r,c,u=!1;const j=function(e,l=t){let s;const i=[];function m(t){if(n(e,t)&&(e=t,s)){const t=!C.length;for(let t=0;t<i.length;t+=1){const l=i[t];l[1](),C.push(l,e)}if(t){for(let t=0;t<C.length;t+=2)C[t][0](C[t+1]);C.length=0}}}return{set:m,update:function(t){m(t(e))},subscribe:function(n,p=t){const g=[n,p];return i.push(g),1===i.length&&(s=l(m)||t),n(e),()=>{const t=i.indexOf(g);-1!==t&&i.splice(t,1),0===i.length&&(s(),s=null)}}}}(0);m(e,j,(t=>s(5,i=t)));const k=async t=>{const e=t.target.files;if(e&&e[0]){const t=new FileReader;t.readAsDataURL(e[0]),await new Promise((e=>{t.onload=e})),s(4,r=t.result),await new Promise((t=>setTimeout(t,50))),s(3,o.width=1280,o),s(3,o.height=720,o),await new Promise((t=>o.addEventListener("canplay",t))),c=new cv.VideoCapture(o);const l=new cv.Mat(720,1280,cv.CV_8UC4);await new Promise((t=>setTimeout(t,200)));const i=29.97;for(;o.duration!=o.currentTime;)c.read(l),p.scan(l),h(o,1,i),j.set(o.currentTime/o.duration),await new Promise((t=>setTimeout(t,50)));j.set(1),console.log(p.charms),l.delete()}p.exportToJson()};setTimeout((async()=>{p=new N,await p.init(),s(0,u=!0)}),1e3);const h=(t,e,l=29.97)=>{const s=1e-5+(t.currentTime*l+e)/l;t.currentTime=Math.min(t.duration,s)};return[u,g,a,o,r,i,j,k,function(t){d[t?"unshift":"push"]((()=>{o=t,s(3,o)}))},t=>k(t),function(){a=this.files,s(2,a)},function(t){d[t?"unshift":"push"]((()=>{g=t,s(1,g)}))},()=>{g.click()},()=>{g.click()}]}return new class extends class{$destroy(){!function(t,e){const l=t.$$;null!==l.fragment&&(s(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const l=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return l.push(e),()=>{const t=l.indexOf(e);-1!==t&&l.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),O(this,t,U,K,n,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
