var app=function(){"use strict";function t(){}function e(t){return t()}function l(){return Object.create(null)}function s(t){t.forEach(e)}function i(t){return"function"==typeof t}function n(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(e,l,s){e.$$.on_destroy.push(function(e,...l){if(null==e)return t;const s=e.subscribe(...l);return s.unsubscribe?()=>s.unsubscribe():s}(l,s))}function p(t,e){t.appendChild(e)}function m(t,e,l){t.insertBefore(e,l||null)}function g(t){t.parentNode.removeChild(t)}function o(t){return document.createElement(t)}function r(t){return document.createTextNode(t)}function c(){return r(" ")}function u(t,e,l,s){return t.addEventListener(e,l,s),()=>t.removeEventListener(e,l,s)}function j(t,e,l){null==l?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}let k;function h(t){k=t}const f=[],d=[],v=[],_=[],P=Promise.resolve();let w=!1;function E(t){v.push(t)}let $=!1;const y=new Set;function L(){if(!$){$=!0;do{for(let t=0;t<f.length;t+=1){const e=f[t];h(e),A(e.$$)}for(h(null),f.length=0;d.length;)d.pop()();for(let t=0;t<v.length;t+=1){const e=v[t];y.has(e)||(y.add(e),e())}v.length=0}while(f.length);for(;_.length;)_.pop()();w=!1,$=!1,y.clear()}}function A(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const b=new Set;function O(t,e){-1===t.$$.dirty[0]&&(f.push(t),w||(w=!0,P.then(L)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function T(n,a,p,m,o,r,c=[-1]){const u=k;h(n);const j=n.$$={fragment:null,ctx:null,props:r,update:t,not_equal:o,bound:l(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:a.context||[]),callbacks:l(),dirty:c,skip_bound:!1};let f=!1;if(j.ctx=p?p(n,a.props||{},((t,e,...l)=>{const s=l.length?l[0]:e;return j.ctx&&o(j.ctx[t],j.ctx[t]=s)&&(!j.skip_bound&&j.bound[t]&&j.bound[t](s),f&&O(n,t)),e})):[],j.update(),f=!0,s(j.before_update),j.fragment=!!m&&m(j.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);j.fragment&&j.fragment.l(t),t.forEach(g)}else j.fragment&&j.fragment.c();a.intro&&((d=n.$$.fragment)&&d.i&&(b.delete(d),d.i(v))),function(t,l,n,a){const{fragment:p,on_mount:m,on_destroy:g,after_update:o}=t.$$;p&&p.m(l,n),a||E((()=>{const l=m.map(e).filter(i);g?g.push(...l):s(l),t.$$.on_mount=[]})),o.forEach(E)}(n,a.target,a.anchor,a.customElement),L()}var d,v;h(u)}function S(t){return new Promise((e=>{const l=new Image;l.src=t,l.onload=()=>{const t=cv.imread(l);e(t)}}))}function x(t,e,l,s,i){const n=new cv.Size(e.cols,e.rows),a=new cv.Rect(l,n),p=t.roi(a),m=new cv.Mat;cv.threshold(e,m,s,255,cv.THRESH_BINARY);const g=new cv.Mat;p.copyTo(g,m);const o=new cv.Mat;cv.absdiff(e,g,o),cv.cvtColor(o,o,cv.COLOR_BGR2GRAY);const r=new cv.Mat;return cv.threshold(o,r,i,255,cv.THRESH_BINARY),o.delete(),g.delete(),m.delete(),p.delete(),r}function R(t,e,l,s=63,i=63){let n=Number.MAX_SAFE_INTEGER,a=null;for(const[p,m]of Object.entries(e)){const e=x(t,m,l,s,i),g=cv.countNonZero(e);n>g&&(n=g,a=p),e.delete()}return a}function I(t){return t instanceof Promise?t:Array.isArray(t)?Promise.all(t.map(I)):"object"==typeof t?function(t){const e=Object.keys(t).map((e=>I(t[e]).then((t=>({key:e,value:t})))));return Promise.all(e).then((t=>t.reduce(((t,e)=>(t[e.key]=e.value,t)),{})))}(t):Promise.resolve(t)}class M{MAX_PAGE=34;COLUMNS_PER_PAGE=10;ROWS_PER_PAGE=5;POINT_RARITY=new cv.Point(1190,176);POINT_SLOTS=new cv.Point(1160,200);POINT_SKILL1=new cv.Point(1033,266);POINT_SKILL2=new cv.Point(1033,317);POINT_SKILL_LEVEL1=new cv.Point(1190,289);POINT_SKILL_LEVEL2=new cv.Point(1190,340);POINT_PAGE=new cv.Point(787,582);POINT_CHARM_AREA_LEFT_TOP=new cv.Point(634,359);SIZE_CHARM_AREA=new cv.Size(357,199);charms={};templates=null;async init(){this.templates={frame:S("img/templates/frame.png"),rare:{7:S("img/templates/rare/7.jpg"),6:S("img/templates/rare/6.jpg"),5:S("img/templates/rare/5.jpg"),4:S("img/templates/rare/4.jpg")},lvl:{0:S("img/templates/lvl/0.jpg"),1:S("img/templates/lvl/1.jpg"),2:S("img/templates/lvl/2.jpg"),3:S("img/templates/lvl/3.jpg"),4:S("img/templates/lvl/4.jpg"),5:S("img/templates/lvl/5.jpg")},slot:{"0-0-0":S("img/templates/slot/0.jpg"),"1-0-0":S("img/templates/slot/1.jpg"),"1-1-0":S("img/templates/slot/11.jpg"),"1-1-1":S("img/templates/slot/111.jpg"),"2-0-0":S("img/templates/slot/2.jpg"),"2-1-0":S("img/templates/slot/21.jpg"),"2-1-1":S("img/templates/slot/211.jpg"),"2-2-0":S("img/templates/slot/22.jpg"),"2-2-1":S("img/templates/slot/221.jpg"),"3-0-0":S("img/templates/slot/3.jpg"),"3-1-0":S("img/templates/slot/31.jpg"),"3-1-1":S("img/templates/slot/311.jpg"),"3-2-0":S("img/templates/slot/32.jpg"),"3-2-1":S("img/templates/slot/321.jpg")},skill:{"KO術":S("img/templates/skill/KO術.jpg"),"匠":S("img/templates/skill/匠.jpg"),"不屈":S("img/templates/skill/不屈.jpg"),"体術":S("img/templates/skill/体術.jpg"),"幸運":S("img/templates/skill/幸運.jpg"),"心眼":S("img/templates/skill/心眼.jpg"),"攻撃":S("img/templates/skill/攻撃.jpg"),"業物":S("img/templates/skill/業物.jpg"),"渾身":S("img/templates/skill/渾身.jpg"),"無し":S("img/templates/skill/無し.jpg"),"砲術":S("img/templates/skill/砲術.jpg"),"耐震":S("img/templates/skill/耐震.jpg"),"耳栓":S("img/templates/skill/耳栓.jpg"),"逆襲":S("img/templates/skill/逆襲.jpg"),"防御":S("img/templates/skill/防御.jpg"),"陽動":S("img/templates/skill/陽動.jpg"),"集中":S("img/templates/skill/集中.jpg"),"ボマー":S("img/templates/skill/ボマー.jpg"),"地質学":S("img/templates/skill/地質学.jpg"),"広域化":S("img/templates/skill/広域化.jpg"),"挑戦者":S("img/templates/skill/挑戦者.jpg"),"早食い":S("img/templates/skill/早食い.jpg"),"植生学":S("img/templates/skill/植生学.jpg"),"毒耐性":S("img/templates/skill/毒耐性.jpg"),"水耐性":S("img/templates/skill/水耐性.jpg"),"氷耐性":S("img/templates/skill/氷耐性.jpg"),"満足感":S("img/templates/skill/満足感.jpg"),"火耐性":S("img/templates/skill/火耐性.jpg"),"破壊王":S("img/templates/skill/破壊王.jpg"),"納刀術":S("img/templates/skill/納刀術.jpg"),"見切り":S("img/templates/skill/見切り.jpg"),"超会心":S("img/templates/skill/超会心.jpg"),"逆恨み":S("img/templates/skill/逆恨み.jpg"),"達人芸":S("img/templates/skill/達人芸.jpg"),"雷耐性":S("img/templates/skill/雷耐性.jpg"),"鬼火纏":S("img/templates/skill/鬼火纏.jpg"),"龍耐性":S("img/templates/skill/龍耐性.jpg"),"ブレ抑制":S("img/templates/skill/ブレ抑制.jpg"),"ランナー":S("img/templates/skill/ランナー.jpg"),"乗り名人":S("img/templates/skill/乗り名人.jpg"),"剛刃研磨":S("img/templates/skill/剛刃研磨.jpg"),"力の解放":S("img/templates/skill/力の解放.jpg"),"反動軽減":S("img/templates/skill/反動軽減.jpg"),"回復速度":S("img/templates/skill/回復速度.jpg"),"回避性能":S("img/templates/skill/回避性能.jpg"),"壁面移動":S("img/templates/skill/壁面移動.jpg"),"弱点特効":S("img/templates/skill/弱点特効.jpg"),"強化持続":S("img/templates/skill/強化持続.jpg"),"弾丸節約":S("img/templates/skill/弾丸節約.jpg"),"弾導強化":S("img/templates/skill/弾導強化.jpg"),"死中に活":S("img/templates/skill/死中に活.jpg"),"気絶耐性":S("img/templates/skill/気絶耐性.jpg"),"泡沫の舞":S("img/templates/skill/泡沫の舞.jpg"),"泥雪耐性":S("img/templates/skill/泥雪耐性.jpg"),"滑走強化":S("img/templates/skill/滑走強化.jpg"),"火事場力":S("img/templates/skill/火事場力.jpg"),"睡眠耐性":S("img/templates/skill/睡眠耐性.jpg"),"砲弾装填":S("img/templates/skill/砲弾装填.jpg"),"翔蟲使い":S("img/templates/skill/翔蟲使い.jpg"),"装填拡張":S("img/templates/skill/装填拡張.jpg"),"装填速度":S("img/templates/skill/装填速度.jpg"),"速射強化":S("img/templates/skill/速射強化.jpg"),"鈍器使い":S("img/templates/skill/鈍器使い.jpg"),"風圧耐性":S("img/templates/skill/風圧耐性.jpg"),"飛び込み":S("img/templates/skill/飛び込み.jpg"),"高速変形":S("img/templates/skill/高速変形.jpg"),"麻痺耐性":S("img/templates/skill/麻痺耐性.jpg"),"回避距離UP":S("img/templates/skill/回避距離UP.jpg"),"ひるみ軽減":S("img/templates/skill/ひるみ軽減.jpg"),"ガード強化":S("img/templates/skill/ガード強化.jpg"),"ガード性能":S("img/templates/skill/ガード性能.jpg"),"攻めの守勢":S("img/templates/skill/攻めの守勢.jpg"),"毒属性強化":S("img/templates/skill/毒属性強化.jpg"),"笛吹き名人":S("img/templates/skill/笛吹き名人.jpg"),"精霊の加護":S("img/templates/skill/精霊の加護.jpg"),"腹減り耐性":S("img/templates/skill/腹減り耐性.jpg"),"体力回復量UP":S("img/templates/skill/体力回復量UP.jpg"),"キノコ大好き":S("img/templates/skill/キノコ大好き.jpg"),"ジャンプ鉄人":S("img/templates/skill/ジャンプ鉄人.jpg"),"スタミナ奪取":S("img/templates/skill/スタミナ奪取.jpg"),"フルチャージ":S("img/templates/skill/フルチャージ.jpg"),"剥ぎ取り鉄人":S("img/templates/skill/剥ぎ取り鉄人.jpg"),"抜刀術【力】":S("img/templates/skill/抜刀術【力】.jpg"),"抜刀術【技】":S("img/templates/skill/抜刀術【技】.jpg"),"爆破属性強化":S("img/templates/skill/爆破属性強化.jpg"),"特殊射撃強化":S("img/templates/skill/特殊射撃強化.jpg"),"睡眠属性強化":S("img/templates/skill/睡眠属性強化.jpg"),"麻痺属性強化":S("img/templates/skill/麻痺属性強化.jpg"),"会心撃【属性】":S("img/templates/skill/会心撃【属性】.jpg"),"属性やられ耐性":S("img/templates/skill/属性やられ耐性.jpg"),"水属性攻撃強化":S("img/templates/skill/水属性攻撃強化.jpg"),"氷属性攻撃強化":S("img/templates/skill/氷属性攻撃強化.jpg"),"火属性攻撃強化":S("img/templates/skill/火属性攻撃強化.jpg"),"爆破やられ耐性":S("img/templates/skill/爆破やられ耐性.jpg"),"砥石使用高速化":S("img/templates/skill/砥石使用高速化.jpg"),"雷属性攻撃強化":S("img/templates/skill/雷属性攻撃強化.jpg"),"龍属性攻撃強化":S("img/templates/skill/龍属性攻撃強化.jpg"),"アイテム使用強化":S("img/templates/skill/アイテム使用強化.jpg"),"スタミナ急速回復":S("img/templates/skill/スタミナ急速回復.jpg"),"散弾・拡散矢強化":S("img/templates/skill/散弾・拡散矢強化.jpg"),"貫通弾・貫通矢強化":S("img/templates/skill/貫通弾・貫通矢強化.jpg"),"通常弾・連射矢強化":S("img/templates/skill/通常弾・連射矢強化.jpg")}},this.templates.page={};for(let t=1;t<=this.MAX_PAGE;t++)this.templates.page[t]=S(`img/templates/page/${t}.png`);this.templates=await I(this.templates),this.reset()}reset(){this.charms={};for(let t=1;t<=this.MAX_PAGE;t++){this.charms[t]={};for(let e=1;e<=this.ROWS_PER_PAGE;e++)this.charms[t][e]={}}}isScaned(t,e,l){return null!=this.charms[t][e][l]}store(t){const{page:e,row:l,col:s}=t;this.charms[e][l][s]=t}scan(t){const e=this._getCurrentPage(t),[l,s]=this._getCurrentCharmPos(t);if(s<.35)return null;const[i,n]=l;if(this.isScaned(e,n,i))return null;const a=this._getRarity(t),p=this._getSlots(t),m=this._getSkills(t),g=this._getSkillLevels(t);this.store({page:e,row:n,col:i,rarity:a,slots:p,skills:m,skillLevels:g})}generateInsertScript(){const t=[];for(let e=1;e<=this.MAX_PAGE;e++)for(let l=1;l<=this.ROWS_PER_PAGE;l++)for(let s=1;s<=this.COLUMNS_PER_PAGE;s++){const i=this.charms[e][l][s];null!=i&&t.push({"第一スキル":i.skills[0],"第一スキルポイント":i.skillLevels[0],"第二スキル":i.skills[1],"第二スキルポイント":i.skillLevels[1],"スロット":i.slots})}return`const inputs = ${JSON.stringify(t)}\n\neval( await (await fetch('https://code.jquery.com/jquery-3.6.0.slim.min.js')).text() )\n\nfor (const input of inputs) {\n  Object.entries(input).forEach(([key, value]) => {\n    $(\`select[aria-label="\${key}"]\`).val(value)\n    $(\`select[aria-label="\${key}"]\`)[0].dispatchEvent(new Event('change', { bubbles: true }))\n  })\n\n  $('button:contains("追加")').click()\n}`}_getRarity(t){return R(t,this.templates.rare,this.POINT_RARITY,63,63)}_getSlots(t){return R(t,this.templates.slot,this.POINT_SLOTS,0,63)}_getSkills(t){return[R(t,this.templates.skill,this.POINT_SKILL1,0,63),R(t,this.templates.skill,this.POINT_SKILL2,0,63)]}_getSkillLevels(t){return[R(t,this.templates.lvl,this.POINT_SKILL_LEVEL1,0,63),R(t,this.templates.lvl,this.POINT_SKILL_LEVEL2,0,63)]}_getCurrentPage(t){return R(t,this.templates.page,this.POINT_PAGE,31,63)}_getCurrentCharmPos(t){const e=new cv.Rect(this.POINT_CHARM_AREA_LEFT_TOP,this.SIZE_CHARM_AREA),l=t.roi(e),s=new cv.Mat;cv.matchTemplate(l,this.templates.frame,s,cv.TM_CCOEFF_NORMED);const{maxLoc:i,maxVal:n}=cv.minMaxLoc(s);return s.delete(),l.delete(),[[1+Math.floor(.5+i.x/36),1+Math.floor(.5+i.y/41)],n]}}const N=[];function C(t){let e,l,s,i,n,a,u,k,h,f,d=Math.floor(100*t[8])+"";return{c(){e=o("div"),l=o("video"),s=o("track"),n=c(),a=o("div"),u=o("progress"),k=c(),h=r(d),f=r("%"),j(s,"kind","captions"),j(l,"class","preview svelte-1axcdqu"),l.src!==(i=t[5])&&j(l,"src",i),j(l,"alt","preview"),u.value=t[8],j(u,"class","svelte-1axcdqu"),j(e,"id","status"),j(e,"class","svelte-1axcdqu")},m(i,g){m(i,e,g),p(e,l),p(l,s),t[11](l),p(e,n),p(e,a),p(a,u),p(a,k),p(a,h),p(a,f)},p(t,e){32&e&&l.src!==(i=t[5])&&j(l,"src",i),256&e&&(u.value=t[8]),256&e&&d!==(d=Math.floor(100*t[8])+"")&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(h,d)},d(l){l&&g(e),t[11](null)}}}function q(e){let l;return{c(){l=o("div"),l.textContent="Loading Files..."},m(t,e){m(t,l,e)},p:t,d(t){t&&g(l)}}}function G(e){let l,i,n,a,r,k,h,f,d;return{c(){var t,e,s;l=o("div"),i=o("input"),n=c(),a=o("img"),k=c(),h=o("div"),h.textContent="Choose Movie",t="display",e="none",i.style.setProperty(t,e,s?"important":""),j(i,"type","file"),j(i,"accept",".mp4"),j(i,"class","svelte-1axcdqu"),a.src!==(r="https://static.thenounproject.com/png/625182-200.png")&&j(a,"src","https://static.thenounproject.com/png/625182-200.png"),j(a,"alt",""),j(a,"class","svelte-1axcdqu"),j(h,"class","svelte-1axcdqu"),j(l,"id","upload"),j(l,"class","svelte-1axcdqu")},m(t,s){m(t,l,s),p(l,i),e[14](i),p(l,n),p(l,a),p(l,k),p(l,h),f||(d=[u(i,"change",e[12]),u(i,"change",e[13]),u(a,"click",e[15]),u(h,"click",e[16])],f=!0)},p:t,d(t){t&&g(l),e[14](null),f=!1,s(d)}}}function K(t){let e;return{c(){e=o("textarea"),e.value=t[7],j(e,"class","svelte-1axcdqu")},m(l,s){m(l,e,s),t[17](e)},p(t,l){128&l&&(e.value=t[7])},d(l){l&&g(e),t[17](null)}}}function H(e){let l,s,i,n,a,r,u=e[5]&&C(e);function k(t,e){return t[0]?G:q}let h=k(e),f=h(e),d=e[1]&&K(e);return{c(){l=o("main"),s=o("h1"),s.textContent=`${U}`,i=c(),u&&u.c(),n=c(),f.c(),a=c(),r=o("div"),d&&d.c(),j(s,"class","svelte-1axcdqu"),j(r,"id","result"),j(r,"class","svelte-1axcdqu"),j(l,"class","svelte-1axcdqu")},m(t,e){m(t,l,e),p(l,s),p(l,i),u&&u.m(l,null),p(l,n),f.m(l,null),p(l,a),p(l,r),d&&d.m(r,null)},p(t,[e]){t[5]?u?u.p(t,e):(u=C(t),u.c(),u.m(l,n)):u&&(u.d(1),u=null),h===(h=k(t))&&f?f.p(t,e):(f.d(1),f=h(t),f&&(f.c(),f.m(l,a))),t[1]?d?d.p(t,e):(d=K(t),d.c(),d.m(r,null)):d&&(d.d(1),d=null)},i:t,o:t,d(t){t&&g(l),u&&u.d(),f.d(),d&&d.d()}}}const U="MHRise Charm Scanner";function F(e,l,s){let i,p,m,g,o,r,c,u,j,k=!1,h=!1;const f=function(e,l=t){let s;const i=[];function a(t){if(n(e,t)&&(e=t,s)){const t=!N.length;for(let t=0;t<i.length;t+=1){const l=i[t];l[1](),N.push(l,e)}if(t){for(let t=0;t<N.length;t+=2)N[t][0](N[t+1]);N.length=0}}}return{set:a,update:function(t){a(t(e))},subscribe:function(n,p=t){const m=[n,p];return i.push(m),1===i.length&&(s=l(a)||t),n(e),()=>{const t=i.indexOf(m);-1!==t&&i.splice(t,1),0===i.length&&(s(),s=null)}}}}(0);a(e,f,(t=>s(8,i=t)));const v=async t=>{const e=t.target.files;if(e&&e[0]){const t=new FileReader;t.readAsDataURL(e[0]),await new Promise((e=>{t.onload=e})),s(5,r=t.result),await new Promise((t=>setTimeout(t,50))),s(4,o.width=1280,o),s(4,o.height=720,o),await new Promise((t=>o.addEventListener("canplay",t))),c=new cv.VideoCapture(o);const l=new cv.Mat(720,1280,cv.CV_8UC4);await new Promise((t=>setTimeout(t,200)));const i=29.97;for(;o.duration!=o.currentTime;)c.read(l),p.scan(l),_(o,1,i),f.set(o.currentTime/o.duration),await new Promise((t=>setTimeout(t,50)));f.set(1),console.log(p.charms),s(1,h=!0),l.delete()}s(7,j=p.generateInsertScript())};window.addEventListener("load",(async()=>{p=new M,await p.init(),s(0,k=!0)}));const _=(t,e,l=29.97)=>{const s=1e-5+(t.currentTime*l+e)/l;t.currentTime=Math.min(t.duration,s)};return[k,h,m,g,o,r,u,j,i,f,v,function(t){d[t?"unshift":"push"]((()=>{o=t,s(4,o)}))},t=>v(t),function(){g=this.files,s(3,g)},function(t){d[t?"unshift":"push"]((()=>{m=t,s(2,m)}))},()=>{m.click()},()=>{m.click()},function(t){d[t?"unshift":"push"]((()=>{u=t,s(6,u)}))}]}return new class extends class{$destroy(){!function(t,e){const l=t.$$;null!==l.fragment&&(s(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const l=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return l.push(e),()=>{const t=l.indexOf(e);-1!==t&&l.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),T(this,t,F,H,n,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
